<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Decomposes functional observations using functional principal components
analysis. A mixed model framework is used to estimate scores and obtain
variance estimates."><title>Functional principal components analysis by smoothed covariance — fpca.sc • fPASS</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Functional principal components analysis by smoothed covariance — fpca.sc"><meta property="og:description" content="Decomposes functional observations using functional principal components
analysis. A mixed model framework is used to estimate scores and obtain
variance estimates."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fPASS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/fPASS.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/SalilKoner/fPASS/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Functional principal components analysis by smoothed covariance</h1>
      <small class="dont-index">Source: <a href="https://github.com/SalilKoner/fPASS/blob/HEAD/R/fpca_sc.R" class="external-link"><code>R/fpca_sc.R</code></a></small>
      <div class="d-none name"><code>fpca.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Decomposes functional observations using functional principal components
analysis. A mixed model framework is used to estimate scores and obtain
variance estimates.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fpca.sc</span><span class="op">(</span></span>
<span>  Y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ydata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Y.pred <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  argvals <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  random.int <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  nbasis <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  pve <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  npc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  useSymm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  makePD <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  center <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cov.est.method <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  integration <span class="op">=</span> <span class="st">"trapezoidal"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>Y, ydata</dt>
<dd><p>the user must supply either <code>Y</code>, a matrix of functions
observed on a regular grid, or a data frame <code>ydata</code> representing
irregularly observed functions. See Details.</p></dd>


<dt>Y.pred</dt>
<dd><p>if desired, a matrix of functions to be approximated using
the FPC decomposition.</p></dd>


<dt>argvals</dt>
<dd><p>the argument values of the function evaluations in <code>Y</code>,
defaults to a equidistant grid from 0 to 1.</p></dd>


<dt>random.int</dt>
<dd><p>If <code>TRUE</code>, the mean is estimated by
<code><a href="https://rdrr.io/pkg/gamm4/man/gamm4.html" class="external-link">gamm4</a></code> with random intercepts. If <code>FALSE</code> (the
default), the mean is estimated by <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></code> treating all the
data as independent.</p></dd>


<dt>nbasis</dt>
<dd><p>number of B-spline basis functions used for estimation of the
mean function and bivariate smoothing of the covariance surface.</p></dd>


<dt>pve</dt>
<dd><p>proportion of variance explained: used to choose the number of
principal components.</p></dd>


<dt>npc</dt>
<dd><p>prespecified value for the number of principal components (if
given, this overrides <code>pve</code>).</p></dd>


<dt>useSymm</dt>
<dd><p>logical, indicating whether to smooth only the upper
triangular part of the naive covariance (when <code>cov.est.method==2</code>).
This can save computation time for large data sets, and allows for
covariance surfaces that are very peaked on the diagonal.</p></dd>


<dt>makePD</dt>
<dd><p>logical: should positive definiteness be enforced for the
covariance surface estimate?</p></dd>


<dt>center</dt>
<dd><p>logical: should an estimated mean function be subtracted from
<code>Y</code>? Set to <code>FALSE</code> if you have already demeaned the data using
your favorite mean function estimate.</p></dd>


<dt>cov.est.method</dt>
<dd><p>covariance estimation method. If set to <code>1</code>, a
one-step method that applies a bivariate smooth to the \(y(s_1)y(s_2)\)
values. This can be very slow. If set to <code>2</code> (the default), a two-step
method that obtains a naive covariance estimate which is then smoothed.</p></dd>


<dt>integration</dt>
<dd><p>quadrature method for numerical integration; only
<code>'trapezoidal'</code> is currently supported.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An object of class <code>fpca</code> containing:</p>
<dl><dt>Yhat</dt>
<dd><p>FPC approximation (projection onto leading components)
of <code>Y.pred</code> if specified, or else of <code>Y</code>.</p></dd>

<dt>Y</dt>
<dd><p>the observed data</p></dd>
<dt>scores</dt>
<dd><p>\(n
\times npc\) matrix of estimated FPC scores.</p></dd>
 <dt>mu</dt>
<dd><p>estimated mean
function (or a vector of zeroes if <code>center==FALSE</code>).</p></dd>
 <dt>efunctions
</dt>
<dd><p>\(d \times npc\) matrix of estimated eigenfunctions of the functional
covariance, i.e., the FPC basis functions.</p></dd>
 <dt>evalues</dt>
<dd><p>estimated
eigenvalues of the covariance operator, i.e., variances of FPC scores.</p></dd>

<dt>npc </dt>
<dd><p>number of FPCs: either the supplied <code>npc</code>, or the minimum
number of basis functions needed to explain proportion <code>pve</code> of the
variance in the observed curves.</p></dd>
 <dt>argvals</dt>
<dd><p>argument values of
eigenfunction evaluations</p></dd>
 <dt>sigma2</dt>
<dd><p>estimated measurement error
variance.</p></dd>
 <dt>diag.var</dt>
<dd><p>diagonal elements of the covariance matrices for
each estimated curve.</p></dd>
 <dt>VarMats</dt>
<dd><p>a list containing the estimated
covariance matrices for each curve in <code>Y</code>.</p></dd>
 <dt>crit.val</dt>
<dd><p>estimated
critical values for constructing simultaneous confidence intervals.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function computes a FPC decomposition for a set of observed curves,
which may be sparsely observed and/or measured with error. A mixed model
framework is used to estimate curve-specific scores and variances.</p>
<p>FPCA via kernel smoothing of the covariance function, with the diagonal
treated separately, was proposed in Staniswalis and Lee (1998) and much
extended by Yao et al. (2005), who introduced the 'PACE' method.
<code>fpca.sc</code> uses penalized splines to smooth the covariance function, as
developed by Di et al. (2009) and Goldsmith et al. (2013).</p>
<p>The functional data must be supplied as either</p><ul><li><p>an \(n
\times d\) matrix <code>Y</code>, each row of which is one functional observation,
with missing values allowed; or</p></li>
<li><p>a data frame <code>ydata</code>, with
columns <code>'.id'</code> (which curve the point belongs to, say \(i\)),
<code>'.index'</code> (function argument such as time point \(t\)), and
<code>'.value'</code> (observed function value \(Y_i(t)\)).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Di, C., Crainiceanu, C., Caffo, B., and Punjabi, N. (2009).
Multilevel functional principal component analysis. <em>Annals of Applied
Statistics</em>, 3, 458--488.</p>
<p>Goldsmith, J., Greven, S., and Crainiceanu, C. (2013). Corrected confidence
bands for functional data using principal components. <em>Biometrics</em>,
69(1), 41--51.</p>
<p>Staniswalis, J. G., and Lee, J. J. (1998). Nonparametric regression
analysis of longitudinal data. <em>Journal of the American Statistical
Association</em>, 93, 1403--1418.</p>
<p>Yao, F., Mueller, H.-G., and Wang, J.-L. (2005). Functional data analysis
for sparse longitudinal data. <em>Journal of the American Statistical
Association</em>, 100, 577--590.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Jeff Goldsmith <a href="mailto:jeff.goldsmith@columbia.edu">jeff.goldsmith@columbia.edu</a>, Sonja Greven
<a href="mailto:sonja.greven@stat.uni-muenchen.de">sonja.greven@stat.uni-muenchen.de</a>, Lan Huo
<a href="mailto:Lan.Huo@nyumc.org">Lan.Huo@nyumc.org</a>, Lei Huang <a href="mailto:huangracer@gmail.com">huangracer@gmail.com</a>, and
Philip Reiss <a href="mailto:phil.reiss@nyumc.org">phil.reiss@nyumc.org</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">cd4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Fit.MM</span> <span class="op">=</span> <span class="fu">fpca.sc</span><span class="op">(</span><span class="va">cd4</span>, var <span class="op">=</span> <span class="cn">TRUE</span>, simul <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Fit.mu</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="va">Fit.MM</span><span class="op">$</span><span class="va">mu</span>,</span></span>
<span class="r-in"><span>                    d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cd4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Fit.basis</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>phi <span class="op">=</span> <span class="va">Fit.MM</span><span class="op">$</span><span class="va">efunctions</span>,</span></span>
<span class="r-in"><span>                       d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cd4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## for one subject, examine curve estimate, pointwise and simultaneous itervals</span></span></span>
<span class="r-in"><span><span class="va">EX</span> <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">EX.MM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>fitted <span class="op">=</span> <span class="va">Fit.MM</span><span class="op">$</span><span class="va">Yhat</span><span class="op">[</span><span class="va">EX</span>,<span class="op">]</span>,</span></span>
<span class="r-in"><span>           ptwise.UB <span class="op">=</span> <span class="va">Fit.MM</span><span class="op">$</span><span class="va">Yhat</span><span class="op">[</span><span class="va">EX</span>,<span class="op">]</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">Fit.MM</span><span class="op">$</span><span class="va">diag.var</span><span class="op">[</span><span class="va">EX</span>,<span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           ptwise.LB <span class="op">=</span> <span class="va">Fit.MM</span><span class="op">$</span><span class="va">Yhat</span><span class="op">[</span><span class="va">EX</span>,<span class="op">]</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">Fit.MM</span><span class="op">$</span><span class="va">diag.var</span><span class="op">[</span><span class="va">EX</span>,<span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           simul.UB <span class="op">=</span> <span class="va">Fit.MM</span><span class="op">$</span><span class="va">Yhat</span><span class="op">[</span><span class="va">EX</span>,<span class="op">]</span> <span class="op">+</span> <span class="va">Fit.MM</span><span class="op">$</span><span class="va">crit.val</span><span class="op">[</span><span class="va">EX</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">Fit.MM</span><span class="op">$</span><span class="va">diag.var</span><span class="op">[</span><span class="va">EX</span>,<span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           simul.LB <span class="op">=</span> <span class="va">Fit.MM</span><span class="op">$</span><span class="va">Yhat</span><span class="op">[</span><span class="va">EX</span>,<span class="op">]</span> <span class="op">-</span> <span class="va">Fit.MM</span><span class="op">$</span><span class="va">crit.val</span><span class="op">[</span><span class="va">EX</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">Fit.MM</span><span class="op">$</span><span class="va">diag.var</span><span class="op">[</span><span class="va">EX</span>,<span class="op">]</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cd4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## plot data for one subject, with curve and interval estimates</span></span></span>
<span class="r-in"><span><span class="va">EX.MM.m</span> <span class="op">=</span> <span class="fu">melt</span><span class="op">(</span><span class="va">EX.MM</span>, id <span class="op">=</span> <span class="st">'d'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">EX.MM.m</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">d</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">variable</span>, color <span class="op">=</span> <span class="va">variable</span>, linetype <span class="op">=</span> <span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>fitted <span class="op">=</span> <span class="fl">1</span>, ptwise.UB <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                        ptwise.LB <span class="op">=</span> <span class="fl">2</span>, simul.UB <span class="op">=</span> <span class="fl">3</span>, simul.LB <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>fitted <span class="op">=</span> <span class="fl">1</span>, ptwise.UB <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                     ptwise.LB <span class="op">=</span> <span class="fl">2</span>, simul.UB <span class="op">=</span> <span class="fl">3</span>, simul.LB <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Months since seroconversion'</span>, y <span class="op">=</span> <span class="st">'Total CD4 Cell Count'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## plot estimated mean function</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">Fit.mu</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">d</span>, y <span class="op">=</span> <span class="va">mu</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Months since seroconversion'</span>, y <span class="op">=</span> <span class="st">'Total CD4 Cell Count'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## plot the first two estimated basis functions</span></span></span>
<span class="r-in"><span><span class="va">Fit.basis.m</span> <span class="op">=</span> <span class="fu">melt</span><span class="op">(</span><span class="va">Fit.basis</span>, id <span class="op">=</span> <span class="st">'d'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Fit.basis.m</span>, <span class="va">variable</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'phi.1'</span>, <span class="st">'phi.2'</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">d</span>,</span></span>
<span class="r-in"><span>y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">variable</span>, color <span class="op">=</span> <span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## input a dataframe instead of a matrix</span></span></span>
<span class="r-in"><span><span class="va">nid</span> <span class="op">&lt;-</span> <span class="fl">20</span></span></span>
<span class="r-in"><span><span class="va">nobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">10</span><span class="op">:</span><span class="fl">20</span>, <span class="va">nid</span>, rep<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    .id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nid</span>, <span class="va">nobs</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    .index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">nobs</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ydata</span><span class="op">$</span><span class="va">.value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">ydata</span><span class="op">$</span><span class="va">.index</span>,</span></span>
<span class="r-in"><span>                              <span class="va">ydata</span><span class="op">$</span><span class="va">.id</span>,</span></span>
<span class="r-in"><span>                              <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span>                                  <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">.5</span>, <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                                  <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">dbeta</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>                              <span class="op">)</span></span></span>
<span class="r-in"><span>                       <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Fit.MM</span> <span class="op">=</span> <span class="fu">fpca.sc</span><span class="op">(</span>ydata<span class="op">=</span><span class="va">ydata</span>, var <span class="op">=</span> <span class="cn">TRUE</span>, simul <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Salil Koner.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

